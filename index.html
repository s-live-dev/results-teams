<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S-LIVE Results - Team</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=BIZ+UDGothic:wght@400;700&family=Noto+Sans+JP:wght@400;700&family=Ramabhadra&family=Arial:wght@400;700&display=swap"
    rel="stylesheet">

  <style>
    <?!=include('styles');
    ?>
    
    /* 初期状態ではコンテンツを非表示 */
    body {
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    
    body.loaded {
      opacity: 1;
    }
  </style>
</head>

<body class="flex flex-col">

  <header class="mobile-only header-gradient">
    <img id="event-flag" src="" alt="Flag" class="hidden">
    <h1 id="event-name" class="text-center"></h1>
  </header>

  <div class="fullscreen-container flex-grow">

    <div class="mobile-only mb-2 border-b border-white-20">
      <nav class="flex flex-wrap" style="margin-bottom: -1px;" aria-label="Tabs">
        <button onclick="changeTab('team-trap')" class="tab active w-1-3 text-center py-2 px-1 border-b-2 border-transparent font-medium text-xs hover-bg-white-10 transition">
                    トラップ
                </button>
        <button onclick="changeTab('team-skeet')" class="tab w-1-3 text-center py-2 px-1 border-b-2 border-transparent font-medium text-xs hover-bg-white-10 transition">
                    スキート
                </button>
        <button onclick="changeTab('team-overall')" class="tab w-1-3 text-center py-2 px-1 border-b-2 border-transparent font-medium text-xs hover-bg-white-10 transition">
                    総合成績
                </button>
      </nav>
    </div>

    <main class="pb-2 lg-pb-0 lg-h-full">
      <div class="lg-grid lg-grid-cols-3 lg-gap-2 lg-h-full">

        <div id="team-trap" class="tab-content lg-block lg-h-full lg-overflow-y-auto">
          <h2 class="section-title desktop-only text-lg font-bold mb-1" style="color: #c855e3;text-align: center;">
            <img src="https://s-live.org/wp-content/plugins/s-live/resource/TRAP.png" class="event-badge-img event-badge-trap inline">トラップ種目 団体
          </h2>
          <div id="team-trap-event" class="space-y-1"></div>
        </div>

        <div id="team-skeet" class="tab-content hidden lg-block lg-h-full lg-overflow-y-auto">
          <h2 class="section-title desktop-only text-lg font-bold mb-1" style="color: #eebf35;text-align: center;">
            <img src="https://s-live.org/wp-content/plugins/s-live/resource/SKEET.png" class="event-badge-img event-badge-skeet inline">スキート種目 団体
          </h2>
          <div id="team-skeet-event" class="space-y-1"></div>
        </div>

        <div id="team-overall" class="tab-content hidden lg-block lg-h-full lg-overflow-y-auto">
          <h2 class="section-title desktop-only text-lg font-bold mb-1 text-green-400" style="text-align: center;">
            <img src="https://s-live.org/wp-content/plugins/s-live/resource/TEAM.png" class="event-badge-img event-badge-team inline">総合成績 団体
          </h2>
          <div id="team-overall-results" class="space-y-1"></div>
        </div>

      </div>
    </main>
  </div>

  <footer class="mobile-only bg-footer p-1 fixed bottom-0 left-0 right-0 text-white-80">
    <div class="container mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <div class="text-left">
          <div id="event-place" class="text-sm font-bold"></div>
          <div id="event-weather" class="text-xs"></div>
        </div>
      </div>
      <div class="flex items-center">
        <img id="qr-code" src="" class="h-12 w-12 bg-white p-0-5">
      </div>
    </div>
  </footer>

<script>
    // スコアカラーリング関数 - インラインスタイルで確実に適用
    function getScoreStyle(score) {
        switch (score) {
            case 23: return 'color: RGB(101, 255, 255) !important;';
            case 24: return 'color: RGB(255, 153, 229) !important; text-decoration: underline solid !important;';
            case 25: return 'color: RGB(255, 255, 101) !important; text-decoration: underline double !important;';
            default: return 'color: #F3F4F6 !important;';
        }
    }
    
    // 合計スコア用のカラーリング関数
    function getTotalScoreStyle(score, defaultColor) {
        switch (score) {
            case 23: return 'color: RGB(101, 255, 255) !important;';
            case 24: return 'color: RGB(255, 153, 229) !important; text-decoration: underline solid !important;';
            case 25: return 'color: RGB(255, 255, 101) !important; text-decoration: underline double !important;';
            default: return `color: ${defaultColor} !important;`;
        }
    }

    // チーム名からアイコンURLを取得する関数
    function getTeamIconUrl(teamName) {
        const baseUrl = "https://s-live.org/wp-content/plugins/s-live/resource/flag/";
        return `${baseUrl}${teamName}.png`; 
    }

    // 画像をプリロードする関数
    function preloadImages(urls) {
        return Promise.all(urls.map(url => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(url);
                img.onerror = () => {
                    console.warn(`Failed to load image: ${url}`);
                    resolve(url); // エラーでも処理を続行
                };
                img.src = url;
            });
        }));
    }

    // すべての必要な画像URLを収集する関数
    function collectImageUrls(data) {
        const urls = new Set();
        
        // ヘッダー画像
        if (data.eventInfo.flagUrl) {
            urls.add(data.eventInfo.flagUrl);
        }
        if (data.eventInfo.qrCodeUrl) {
            urls.add(data.eventInfo.qrCodeUrl);
        }
        
        // バッジ画像
        urls.add('https://s-live.org/wp-content/plugins/s-live/resource/TRAP.png');
        urls.add('https://s-live.org/wp-content/plugins/s-live/resource/SKEET.png');
        urls.add('https://s-live.org/wp-content/plugins/s-live/resource/TEAM.png');
        
        // チームアイコン
        const allTeams = [
            ...(data.teamEvent.trap || []),
            ...(data.teamEvent.skeet || []),
            ...(data.teamOverall || [])
        ];
        
        allTeams.forEach(team => {
            if (team.name) {
                urls.add(getTeamIconUrl(team.name));
            }
        });
        
        return Array.from(urls);
    }

    function renderTeamEvent(data, targetId, color) {
      const container = document.getElementById(targetId);
      if (!data || data.length === 0) {
          container.innerHTML = '<p class="text-gray-400 text-center p-4">データがありません。</p>';
          return;
      }

      container.innerHTML = data.map((team) => `
          <div class="bg-card backdrop-blur-sm rounded-lg shadow-lg border border-white-20" 
              data-team-card="${team.name}">
              <div class="w-full flex justify-between items-center px-6 py-2 lg-py-1 text-left font-bold" style="color: #F3F4F6 !important;">
                  <div class="flex items-center justify-center">
                      <span class="team-rank w-8 text-left text-lg lg-text-base" style="color: #F3F4F6 !important;">${team.rank}</span>
                      <img src="${getTeamIconUrl(team.name)}" alt="${team.name} icon" class="team-icon-style">
                      <span class="team-name flex-1 pr-4 text-center lg-text-base" style="color: #F3F4F6 !important;">${team.name}</span>
                  </div>
                  <div class="flex items-center justify-center">
                      <span class="team-total text-xl lg-text-lg mr-0" style="${getTotalScoreStyle(team.total, color)}">${team.total}</span>
                  </div>
              </div>

              <div class="pb-2">
                  <div class="px-6">
                      <div class="overflow-x-auto">
                          <table class="w-full text-sm min-w-300 table-fixed">
                              <colgroup>
                                  <col style="width: 7% !important;">   <col style="width: 40% !important;">  <col style="width: 8% !important;">   <col style="width: 8% !important;">   <col style="width: 8% !important;">   <col style="width: 8% !important;">   <col style="width: 13% !important;">
                              </colgroup>
                              <tbody class="divide-y">
                                  ${team.players.map(p => `
                                      <tr data-team="${team.name}" data-player="${p.name}">
                                          <td class="py-0-5 player-score" style="color: #F3F4F6 !important;">${p.rank}</td>
                                          <td class="py-0-5 pl-0 player-name" style="color: #F3F4F6 !important;">${p.name}<span class="player-pos"> (${p.pos})</span></td>
                                          <td class="text-right py-0-5 player-score" style="${getScoreStyle(p.r1)}">${p.r1}</td>
                                          <td class="text-right py-0-5 player-score" style="${getScoreStyle(p.r2)}">${p.r2}</td>
                                          <td class="text-right py-0-5 player-score" style="${getScoreStyle(p.r3)}">${p.r3}</td>
                                          <td class="text-right py-0-5 player-score" style="${getScoreStyle(p.r4)}">${p.r4}</td>
                                          // renderTeamEvent関数を修正
                                          <td class="text-right lg-text-center py-0-5 pr-0 font-bold player-score">
                                              <span class="score-value" style="${getTotalScoreStyle(p.total, color)}">${p.total}</span>
                                          </td>
                                      </tr>
                                  `).join('')}
                              </tbody>
                          </table>
                      </div>
                  </div>
              </div>
          </div>
      `).join('');
    }

    function renderTeamOverall(data, targetId) {
        const container = document.getElementById(targetId);
        if (!data || data.length === 0) {
            container.innerHTML = '<p class="text-gray-400 text-center p-4">データがありません。</p>';
            return;
        }
        container.innerHTML = data.map(team => `
            <div class="bg-card backdrop-blur-sm rounded-lg shadow-lg border border-white-20">
                <button onclick="toggleAccordion(this)" class="w-full flex justify-between items-center px-6 py-2 lg-py-1 text-left font-bold" style="color: #F3F4F6 !important;">
                    <div class="flex items-center justify-center">
                        <span class="team-rank w-8 text-left text-lg lg-text-base">${team.rank}</span>
                        <img src="${getTeamIconUrl(team.name)}" alt="${team.name} icon" class="team-icon-style">
                        <span class="team-name flex-1 pr-4 text-center lg-text-base">${team.name}</span>
                    </div>
                    <div class="flex items-center justify-end team-total-container">
                        <div class="team-total-breakdown">
                            <span style="color: #c855e3 !important;">${team.trapTotal}</span>
                            <span class="total-separator"> + </span>
                            <span style="color: #eebf35 !important;">${team.skeetTotal}</span>
                            <span class="total-separator">:</span>
                        </div>
                        <span class="team-total-overall" style="${getTotalScoreStyle(team.overallTotal, '#4ade80')}">
                            ${team.overallTotal}
                        </span>
                        <i class="fa-solid fa-chevron-down accordion-chevron transition-transform duration-300"></i>
                    </div>
                </button>
                <div class="accordion-content">
                    <div class="px-6">
                        <div class="lg-grid lg-grid-cols-2 lg-gap-4">
                            <div class="mb-4 lg-mb-1">
                                <h4 class="font-bold mb-2 lg-mb-1 text-sm lg-font-black" style="color: #c855e3;">
                                    <img src="https://s-live.org/wp-content/plugins/s-live/resource/TRAP.png" class="team-score-badge trap inline">
                                    トラップ: <span style="${getTotalScoreStyle(team.trapTotal, '#c855e3')}">${team.trapTotal}点</span>
                                </h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm table-fixed">
                                        <colgroup>
                                            <col style="width: 12% !important;">  <col style="width: 43% !important;">  <col style="width: 8% !important;">   <col style="width: 8% !important;">   <col style="width: 8% !important;">   <col style="width: 8% !important;">   <col style="width: 13% !important;">
                                        </colgroup>
                                        <tbody class="divide-y">
                                            ${team.trapPlayers.map(p => `
                                                <tr data-team="${team.name}" data-player="${p.name}" style="color: #F3F4F6 !important;">
                                                    <td class="py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="color: #F3F4F6 !important;">${p.rank}</td>
                                                    <td class="py-0-5 lg-py-0 pl-0 player-name lg-text-xs lg-leading-tight" style="color: #F3F4F6 !important;">${p.name}<span class="player-pos"> (${p.pos})</span></td>
                                                    <td class="text-right py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="${getScoreStyle(p.r1)}">${p.r1}</td>
                                                    <td class="text-right py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="${getScoreStyle(p.r2)}">${p.r2}</td>
                                                    <td class="text-right py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="${getScoreStyle(p.r3)}">${p.r3}</td>
                                                    <td class="text-right py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="${getScoreStyle(p.r4)}">${p.r4}</td>
                                                    <td class="text-right lg-text-center py-0-5 lg-py-0 pr-0 font-bold player-score lg-text-xs lg-leading-tight">
                                                        <span class="score-value" style="${getTotalScoreStyle(p.total, '#c855e3')}">${p.total}</span>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-bold mb-2 lg-mb-1 text-sm lg-font-black" style="color: #eebf35;">
                                    <img src="https://s-live.org/wp-content/plugins/s-live/resource/SKEET.png" class="team-score-badge skeet inline">
                                    スキート: <span style="${getTotalScoreStyle(team.skeetTotal, '#eebf35')}">${team.skeetTotal}点</span>
                                </h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm table-fixed">
                                        <colgroup>
                                            <col style="width: 12% !important;">  <col style="width: 43% !important;">  <col style="width: 8% !important;">   <col style="width: 8% !important;">   <col style="width: 8% !important;">   <col style="width: 8% !important;">   <col style="width: 13% !important;">
                                        </colgroup>
                                        <tbody class="divide-y">
                                            ${team.skeetPlayers.map(p => `
                                                <tr data-team="${team.name}" data-player="${p.name}" style="color: #F3F4F6 !important;">
                                                    <td class="py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="color: #F3F4F6 !important;">${p.rank}</td>
                                                    <td class="py-0-5 lg-py-0 pl-0 player-name lg-text-xs lg-leading-tight" style="color: #F3F4F6 !important;">${p.name}<span class="player-pos"> (${p.pos})</span></td>
                                                    <td class="text-right py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="${getScoreStyle(p.r1)}">${p.r1}</td>
                                                    <td class="text-right py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="${getScoreStyle(p.r2)}">${p.r2}</td>
                                                    <td class="text-right py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="${getScoreStyle(p.r3)}">${p.r3}</td>
                                                    <td class="text-right py-0-5 lg-py-0 player-score lg-text-xs lg-leading-tight" style="${getScoreStyle(p.r4)}">${p.r4}</td>
                                                    <td class="text-right lg-text-center py-0-5 lg-py-0 pr-0 font-bold player-score lg-text-xs lg-leading-tight">
                                                        <span class="score-value" style="${getTotalScoreStyle(p.total, '#eebf35')}">${p.total}</span>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function renderHeaderAndFooter(info) {
        if (!info) return;
        const eventName = document.getElementById('event-name');
        if (eventName) eventName.textContent = info.name;
        if (info.flagUrl) {
            const flagImg = document.getElementById('event-flag');
            if (flagImg) {
                flagImg.src = info.flagUrl;
                flagImg.classList.remove('hidden');
            }
        }
        const eventPlace = document.getElementById('event-place');
        if (eventPlace) eventPlace.textContent = info.place;
        const eventWeather = document.getElementById('event-weather');
        if (eventWeather) eventWeather.innerHTML = info.weather;
        const qrCode = document.getElementById('qr-code');
        if (qrCode) qrCode.src = info.qrCodeUrl;
    }

    // --- イベントハンドラ ---
    function changeTab(tabName) {
        if (window.innerWidth >= 1024) return;
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabName).classList.remove('hidden');
        document.querySelector(`button[onclick="changeTab('${tabName}')"]`).classList.add('active');
    }

    function toggleAccordion(buttonElement) {
        if (window.innerWidth >= 1024) return;
        const content = buttonElement.nextElementSibling;
        const icon = buttonElement.querySelector('i');
        if (content.style.maxHeight) {
            content.style.maxHeight = null;
            icon.classList.remove('rotate-180');
        } else {
            content.style.maxHeight = content.scrollHeight + "px";
            icon.classList.add('rotate-180');
        }
    }
    
    function handleResize() {
        if (window.innerWidth >= 1024) {
            document.getElementById('team-trap').classList.remove('hidden');
            document.getElementById('team-skeet').classList.remove('hidden');
            document.getElementById('team-overall').classList.remove('hidden');
            document.querySelectorAll('.accordion-content').forEach(content => {
                content.style.maxHeight = 'none';
            });
            document.querySelectorAll('.accordion-chevron').forEach(icon => {
                icon.classList.add('rotate-180');
            });
        } else {
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) {
                const tabName = activeTab.getAttribute('onclick').match(/'([^']+)'/)[1];
                document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                document.getElementById(tabName).classList.remove('hidden');
            }
            document.querySelectorAll('.accordion-content').forEach(content => {
                content.style.maxHeight = null;
            });
            document.querySelectorAll('.accordion-chevron').forEach(icon => {
                icon.classList.remove('rotate-180');
            });
        }
    }

    // --- データ取得と画面描画 ---
    // グローバルスコープで変数を定義
    const spreadsheetId = '<?!= s ?>';
    const qrParam = '<?!= qr ?>';
    const fiveMinutes = 5 * 60 * 1000; // 5分

// タイムスタンプベースの更新検知（完全版）
function detectAndHighlightChanges(newData) {
    const now = new Date();

    
    console.log('現在時刻:', now.toLocaleString('ja-JP')); // デバッグ用
    
    // 各種目での更新時刻チェック（トラップ・スキート種目別）
    ['trap', 'skeet'].forEach(discipline => {
        newData.teamEvent[discipline].forEach(team => {
            team.players.forEach(player => {
                if (player.updateTime) {
                    // 文字列からDate型に変換（日本時間として解釈）
                    const updateTime = new Date(player.updateTime);
                    const diff = now - updateTime;
                    
                    console.log(`[${discipline}] ${player.name}: 更新時刻=${player.updateTime}, 差分=${Math.floor(diff/1000)}秒`); // デバッグ用
                    
                    if (diff >= 0 && diff <= fiveMinutes) {
                        // 5分以内の更新なら点滅対象
                        highlightPlayer(team.name, player.name);
                    }
                }
            });
        });
    });
    
    // 総合成績での更新時刻チェック
    newData.teamOverall.forEach(team => {
        // トラップ選手（上位5名）
        team.trapPlayers.forEach(player => {
            if (player.updateTime) {
                const updateTime = new Date(player.updateTime);
                const diff = now - updateTime;
                
                console.log(`[総合-トラップ] ${player.name}: 更新時刻=${player.updateTime}, 差分=${Math.floor(diff/1000)}秒`); // デバッグ用
                
                if (diff >= 0 && diff <= fiveMinutes) {
                    highlightPlayer(team.name, player.name);
                }
            }
        });
        
        // スキート選手（上位3名）
        team.skeetPlayers.forEach(player => {
            if (player.updateTime) {
                const updateTime = new Date(player.updateTime);
                const diff = now - updateTime;
                
                console.log(`[総合-スキート] ${player.name}: 更新時刻=${player.updateTime}, 差分=${Math.floor(diff/1000)}秒`); // デバッグ用
                
                if (diff >= 0 && diff <= fiveMinutes) {
                    highlightPlayer(team.name, player.name);
                }
            }
        });
    });
}

// 選手の行全体を点滅させる
function highlightPlayer(teamName, playerName) {
    setTimeout(() => {
        const selector = `tr[data-team="${teamName}"][data-player="${playerName}"]`;
        const rows = document.querySelectorAll(selector);
        
        console.log(`点滅対象検索: ${selector}, 見つかった行数: ${rows.length}`); // デバッグ用
        
        rows.forEach(row => {
            // 行全体に点滅クラスを追加
            row.classList.add('updnew');
            console.log(`点滅クラス追加: ${teamName} - ${playerName}`); // デバッグ用
            
            // 5分後に点滅クラスを削除
            setTimeout(() => {
                row.classList.remove('updnew');
            }, fiveMinutes);
        });
    }, 500);
}

// fetchData関数も修正（前回データの保存は不要に）
function fetchData() {
    google.script.run
        .withSuccessHandler(data => {
            if (data.error) {
                console.error("Error from GAS: ", data.error);
                document.body.innerHTML = `<p class="text-red-500 p-4">データ取得エラー: ${data.error}</p>`;
                return;
            }
            
            // 画像URLを収集
            const imageUrls = collectImageUrls(data);
            
            // すべての画像をプリロードしてから表示
            preloadImages(imageUrls).then(() => {
                renderHeaderAndFooter(data.eventInfo);
                renderTeamEvent(data.teamEvent.trap, 'team-trap-event', '#c855e3');
                renderTeamEvent(data.teamEvent.skeet, 'team-skeet-event', '#eebf35');
                renderTeamOverall(data.teamOverall, 'team-overall-results');
                
                handleResize();
                
                // タイムスタンプベースの更新検知（毎回実行）
                detectAndHighlightChanges(data);
                
                // コンテンツの表示
                document.body.classList.add('loaded');
            });
        })
        .withFailureHandler(error => {
            console.error("Error fetching data: ", error);
            document.body.innerHTML = '<p class="text-red-500 p-4">データ取得エラー</p>';
        })
        .getTeamData(spreadsheetId, qrParam);
}


    // PC版での順位変動検知とアニメーション
    function detectRankChanges(newData, oldData) {
        if (window.innerWidth < 1024) return; // PC版のみ
        
        const rankChanges = [];
        
        ['trap', 'skeet'].forEach(discipline => {
            const oldRankMap = new Map();
            oldData.teamEvent[discipline].forEach(team => {
                oldRankMap.set(team.name, team.rank);
            });
            
            newData.teamEvent[discipline].forEach(team => {
                const oldRank = oldRankMap.get(team.name);
                if (oldRank && oldRank !== team.rank) {
                    rankChanges.push({
                        discipline,
                        teamName: team.name,
                        oldRank,
                        newRank: team.rank,
                        direction: team.rank < oldRank ? 'up' : 'down'
                    });
                }
            });
        });
        
        // アニメーション実行
        if (rankChanges.length > 0) {
            animateRankChanges(rankChanges);
        }
    }

    // 順位移動アニメーション
    function animateRankChanges(changes) {
        changes.forEach(change => {
            const card = document.querySelector(
                `#team-${change.discipline}-event [data-team-card="${change.teamName}"]`
            );
            
            if (card) {
                // 移動距離を計算
                const moveDistance = (change.oldRank - change.newRank) * card.offsetHeight;
                
                // CSSトランジションを設定
                card.style.transition = 'transform 0.8s ease-in-out';
                card.style.transform = `translateY(${moveDistance}px)`;
                
                // アニメーション完了後
                setTimeout(() => {
                    card.style.transition = '';
                    card.style.transform = '';
                    
                    // 点滅開始（順位が上がった場合のみ）
                    if (change.direction === 'up') {
                        card.classList.add('rank-improved');
                        setTimeout(() => {
                            card.classList.remove('rank-improved');
                        }, 5000);
                    }
                }, 800);
            }
        });
    }

    // --- 初期化処理 ---
    document.addEventListener('DOMContentLoaded', () => {
        handleResize();
        fetchData();
        setInterval(fetchData, 30000); // 30秒ごとに更新
    });

    window.addEventListener('resize', handleResize);

</script>
</body>

</html>